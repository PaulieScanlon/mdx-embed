<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MDX Embed</title>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      async function postToApi(payload) {
        console.log('postToApi: ', payload);

        try {
          var response = await axios.post(
            'https://paulieapi.gatsbyjs.io/api/dummy-stripe-payment',
            {
              amount: payload.value,
              product: payload.product,
              success_url: 'https://paulieapi.gatsbyjs.io/stripe-payment',
              cancel_url: 'https://paulieapi.gatsbyjs.io/stripe-payment',
            },
            {
              headers: {
                'Access-Control-Allow-Origin': 'https://www.mdx-embed.com/',
                'Content-Type': 'application/json',
              },
            },
          );

          // var response = await axios.post('https://paulieapi.gatsbyjs.io/api/dummy-stripe-payment', {
          //   amount: payload.value,
          //   product: payload.product,
          //   success_url: 'https://paulieapi.gatsbyjs.io/stripe-payment',
          //   cancel_url: 'https://paulieapi.gatsbyjs.io/stripe-payment',
          //   // success_url: payload.success_url,
          //   // cancel_url: payload.cancel_url,
          // });
          console.log(JSON.stringify(response, null, 2));
        } catch (error) {
          console.warn(JSON.stringify(error, null, 2));
        }
      }

      window.onload = function () {
        console.log('onload');

        var iframeWin = document.getElementById('storybook-preview-iframe').contentWindow;
        var stripeInput = iframeWin.document.getElementById('stripe-input');
        var stripeButton = iframeWin.document.getElementById('stripe-button');
        var stripeCta = iframeWin.document.getElementById('stripe-cta');
        var stripeSpinner = iframeWin.document.getElementById('stripe-spinner');
        var stripeLink = iframeWin.document.getElementById('stripe-link');

        window.addEventListener(
          'message',
          (event) => {
            if (event.data.type === 'submit') {
              postToApi(event.data);
              // stripeInput.style.display = 'none';
              stripeInput.setAttribute('aria-hidden', true);
              stripeInput.setAttribute('disabled', true);
              stripeButton.setAttribute('disabled', true);
              stripeCta.style.display = 'none';
              stripeCta.setAttribute('aria-hidden', true);
              stripeSpinner.style.display = 'block';
              stripeSpinner.setAttribute('aria-hidden', false);
              // stripeButton.style.display = 'none';
              // stripeButton.setAttribute('aria-hidden', true);
              // stripeLink.style.display = 'block';
              // stripeLink.setAttribute('aria-hidden', false);
            }
          },
          false,
        );
      };
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76055934-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-76055934-5');
    </script>

    <link rel="icon" type="image/png" sizes="16x16" href="https://mdx-embed.com/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://mdx-embed.com/favicon-32x32.png" />
    <meta name="description" content="Embed popular 3rd party media content in .mdx - no import required!" />
    <meta name="image" content="https://mdx-embed.com/mdx-embed-og-image.jpg" />
    <meta name="image:alt" content="Embed popular 3rd party media content in .mdx - no import required!" />
    <meta name="keywords" content="MDX" />

    <!-- Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="MDX Embed" />
    <meta property="og:url" content="https://mdx-embed.com/" />
    <meta property="og:description" content="Embed popular 3rd party media content in .mdx - no import required!" />
    <meta property="og:image" content="https://mdx-embed.com/mdx-embed-og-image.jpg" />
    <meta property="og:image:alt" content="Embed popular 3rd party media content in .mdx - no import required!" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="MDX Embed" />
    <meta name="twitter:url" content="https://mdx-embed.com/" />
    <meta name="twitter:description" content="Embed popular 3rd party media content in .mdx - no import required!" />
    <meta name="twitter:image" content="https://mdx-embed.com/mdx-embed-og-image.jpg" />
    <meta name="twitter:image:alt" content="Embed popular 3rd party media content in .mdx - no import required!" />
  </head>
</html>
